\chapter{总结与展望}

\section{本文总结}
\label{sec:本文总结}
比特币项目的空前成功促使人们开始思考能否将区块链技术拓展到更多的应用场景，于是诞生了可用于开发去中心化应用的智能合约。以区块链技术为载体的智能合约，凭借其不可篡改、自动执行和去中心化等特点，一经问世便迅速获得了广泛关注。然而，智能合约作为一种计算机程序，不可避免会因为编程错误而产生漏洞，这也为传统的软件缺陷预测工作开辟了新的领域。区块链的高安全性与智能合约的漏洞形成了不可调和的矛盾，正是这种矛盾吸引了开发者和研究人员对智能合约漏洞检测方法的探索，本文诞生的动机正源于此。总结来说，本文提出了基于静态代码指标和语义特征融合的智能合约漏洞检测方法，具体的贡献主要表现在以下四个方面：
\begin{enumerate}[label=(\arabic*)]
    \item 定义了34个智能合约中基于静态代码指标的专家特征。
    
    在软件工程研究中，静态代码指标往往发挥着重要作用，它们能在一定维度上反映源代码的结构特征，而且比较容易获取，因此可以利用这些特征去构建软件缺陷的检测模型。本文基于软件工程的研究经验，从静态代码指标入手，针对智能合约源代码定义了34个专家特征，然后收集了一个大规模的数据集（包含xxx份智能合约源代码）并编写程序提取了这些专家特征。实验结果证明了专家特征对智能合约漏洞检测和运行时异常检测的有效性。
    
    \item 构建了智能合约的数据流图、控制流图和函数调用图。
    
    在大规模预训练模型盛行之初，大多数相关研究都只将源代码视作文本序列，而忽视了其中丰富的结构特征和语义信息。相比于抽象语法树较深的层次结构，数据流等语义图拥有较为简单的结构，又能在一定程度上保留源代码的语义信息，因此Guo等人\cite{guo2020graphcodebert}首次将数据流图引入了预训练模型中。本文在前作的基础上，在预训练模型中增加控制流图和函数调用图，并设计了算法从智能合约的AST中构建语义图，进一步丰富了模型学习到的源代码语义信息。实验结果表明了这两种语义图在智能合约漏洞检测任务上的有效性。

    \item 提出了融合专家特征和语义特征进行智能合约漏洞检测的方法。
    
    基于静态代码指标的专家特征能在一定维度上反映源代码的结构特征，基于程序语义图的语义特征能表达出源代码的语义信息。此前大多数智能合约相关的工作都是选择单独基于上述两种特征之一进行研究，这不可避免会导致部分信息的缺失，因此本文提出了融合专家特征和语义特征的方法，并将其应用在智能合约漏洞检测研究中。实验结果表明，相比于只使用单一种类的特征，基于特征融合的预训练模型更能有效地表达程序的结构特征和语义信息。

    \item 探索了利用预训练模型对智能合约进行运行时崩溃预测的方法。

    当前，有关智能合约在运行时崩溃的研究工作寥寥无几，本文从Etherscan提供的API抓取以太坊交易的执行结果，标注了一个包含xxx份智能合约的交易信息的数据集，并且分析了数据集中导致交易崩溃的不同原因。然后在智能合约漏洞检测工作的基础上，利用预训练模型对数据集中的智能合约进行运行时崩溃预测，实验结果表明，本文的方法可以在一定程度上预测出智能合约在运行时是否会崩溃。最后探究了智能合约的各种漏洞与运行时崩溃的关系，结果表明重入漏洞和算术漏洞最有可能导致合约在运行时崩溃。

\end{enumerate}
\section{未来展望}
\label{sec:未来展望}

本文提出的智能合约漏洞检测方法在实验中取得了不错的效果，但不可否认依然存在很多缺陷，接下来就本文的不足之处以及未来该领域的发展方向进行探讨。

\begin{enumerate}[label=(\arabic*)]
    \item 智能合约源代码数据集规模不足。
    
    本文搜集了一个包含xxx份智能合约源代码的数据集，智能合约的数量在同类工作中并不算少，但是值得注意的是，在行文之时，部署在以太坊网络上的智能合约字节码已经多达\num{64645990}份，而经过Etherscan网站验证的智能合约源代码仅有\num{598549}份，仅占0.9\%，差异非常巨大\footnote{这是因为部署在以太坊上的智能合约只包含编译后的字节码，源代码需要作者主动上传到类似Etherscan的网站，后台对其编译并与部署在以太坊上的字节码对比一致后，才会发布到网站上。}。针对于此，可以探索基于智能合约字节码的漏洞检测方法，或者将其反编译为源代码对现有数据集进行扩充，庞大的数据集在当前大规模预训练模型的基础上，可能会收获意想不到的效果。

    \item 现有的静态指标对智能合约的结构特征挖掘不足。
    
    本文提出了34个静态代码指标用于表达智能合约的结构特征，但是这些指标中大多是笔者依据软件工程的研究经验借鉴而来，对于Solidity源代码的特有语法挖掘不够深入。因此，从Solidity语法和智能合约运行机制等入手，深入挖掘能充分表达智能合约结构信息的指标，可能会对智能合约漏洞检测、运行时崩溃预测以及相关研究带来较大的提升。
    
    \item 能充分利用结构化语义特征的预训练模型值得进一步探索。
    
    GraphCodeBERT\cite{guo2020graphcodebert}模型首次尝试将源代码与数据流图融合进行训练，Peculiar\cite{wu2021peculiar}将其应用到智能合约漏洞检测领域，虽然在实验中取得了不错的效果，但是不容忽视的是，单独的数据流图相对于AST会丢失相当的语义信息，导致程序的结构化语义信息没有被完全利用起来。GraphCodeBERT模型的原作者在两年后提出了UniXcoder模型，他们构建了从AST到序列结构一对一的映射函数，然后与源代码拼接后进行预训练。如果该映射函数的正确性能得到保证，那么借鉴此方法来构建全新的智能合约漏洞检测模型非常值得进一步探索。

    \item 对于智能合约运行时崩溃预测的研究不够深入。
    
    智能合约运行时异常导致的交易失败会带来资源和费用的浪费，如果能在发送交易前，根据当前合约特征和状态信息对交易结果进行预测，提前发现可能失败的交易，便能提高以太坊的运行效率，同时节省交易手续费。然而目前该方向的研究工作还存在比较大的空白，如果能深入挖掘以太坊网络的运行机制和虚拟机的工作原理，配合现有的有关智能合约源代码的研究成果，或许能取得不错的进展。
\end{enumerate}

